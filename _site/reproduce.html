<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Environments: Reproduce</title>
  
  <meta property="description" itemprop="description" content="Reproduce Environments Over Time"/>
  
  
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Environments: Reproduce"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Reproduce Environments Over Time"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Environments"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Environments: Reproduce"/>
  <meta property="twitter:description" content="Reproduce Environments Over Time"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description"]}},"value":[{"type":"character","attributes":{},"value":["Reproduce"]},{"type":"character","attributes":{},"value":["Reproduce Environments Over Time"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.radix-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .radix-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #455a64;
    font-size: 15px;
    font-weight: 300;
  }
  
  .radix-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .radix-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .radix-site-nav {
      display: none;
    }
  }
  
  .radix-site-header {
  
  }
  
  .radix-site-footer {
  
  }
  
  
  /* Site Header */
  
  .radix-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .radix-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .radix-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .radix-site-header a,
  .radix-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .radix-site-header .title {
    font-size: 18px;
  }
  
  .radix-site-header .logo {
    padding: 0;
  }
  
  .radix-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .radix-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .radix-site-header .logo img {
      display: inline-block;
    }
    .radix-site-header .nav-left {
      margin-left: 20px;
    }
    .radix-site-header .nav-right {
      margin-right: 20px;
    }
    .radix-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .radix-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header a, .radix-site-header .nav-dropdown  {display: none;}
    .radix-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .radix-site-header .title {
      margin-left: 0;
    }
    .radix-site-header .nav-right {
      margin-right: 0;
    }
    .radix-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .radix-site-header.responsive {position: relative;}
    .radix-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .radix-site-header.responsive a,
    .radix-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .radix-site-header.responsive .nav-left,
    .radix-site-header.responsive .nav-right {
      width: 100%;
    }
    .radix-site-header.responsive .nav-dropdown {float: none;}
    .radix-site-header.responsive .nav-dropdown-content {position: relative;}
    .radix-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .radix-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  </style>
  
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.text();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.text(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        if ($.inArray(language, ["r", "cpp", "c", "java"]) != -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      $(this).find('img, .html-widget').css('width', '100%');
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.radix-site-header a').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/htmlwidgets-1.2.1/htmlwidgets.js"></script>
  <script src="site_libs/plotly-binding-4.7.1/plotly.js"></script>
  <script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
  <script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
  <link href="site_libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
  <script src="site_libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>
  <script src="site_libs/viz-0.3/viz.js"></script>
  <link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
  <script src="site_libs/grViz-binding-1.0.0/grViz.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Reproduce","description":"Reproduce Environments Over Time","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="radix-site-nav radix-site-header">
<div class="nav-left">
<a href="index.html" class="title">Environments</a>
</div>
<div class="nav-right">
<div class="nav-dropdown">
<button class="nav-dropbtn">
Use Cases
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="upgrades.html">Upgrading Packages Safely</a>
<a href="reproduce.html">Reproduce Environments</a>
<a href="picking.html">How to Pick a Package</a>
<a href="validation.html">Validated Environments</a>
<a href="deploy.html">Production Deployments</a>
<a href="collaborate.html">Team Collaboration</a>
</div>
</div>
<a href="reproduce.html">Strategies</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
R Packages
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="installation.html">Installing - pak / remotes</a>
<a href="repositories.html">Repositories - RStudio Package Manager</a>
<a href="libraries.html">Libraries - renv</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Other Components
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="R-installation.html">R Installations</a>
<a href="Docker.html">Docker</a>
<a href="Python.html">Python</a>
</div>
</div>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Reproduce</h1>
<p>Reproduce Environments Over Time</p>
</div>


<div class="d-article">
<p>Reproducing data science work is the main objective of environment management. This page details three strategies for reproducing R environments overtime. To select a strategy, you will need to answer two questions:</p>
<ol type="1">
<li>Who is responsible for managing the environment?<br />
</li>
<li>How open is the environment?</li>
</ol>
<p>At first these two questions might seem similar, but separating the two uncovers common “danger zones” or “anti-strategies”. The map below depicts these danger zones as well as three successful strategies. Use the map and the two questions above to determine where your organization currently operates and identify which strategy to move towards. Once selected, the sections below outline how to implement each strategy. Characteristics of each danger zone are detailed as well.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div id="62675cf934a2" style="width:576px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="62675cf934a2">{"x":{"data":[{"x":[-0.05,1.05],"y":[0.15,1.25],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.2)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,0,0.8,0],"y":[0.2,1,1,0.2],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(255,0,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,1,0.8,0,0],"y":[null,0.8,1,0.2,null],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,255,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,0,1,0.2,0],"y":[0,0.2,0.8,0,0],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,255,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0.2,1,1,0.2],"y":[0,0,0.8,0],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(255,0,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[-0.05,1.05],"y":[-0.25,0.85],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.2)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.5,0.75,0.2],"y":[0.75,0.2,0.8],"text":["Open access, <br /> not reproducible, <br /> how we learn","Backdoor package access, <br /> offline systems without a strategy","Admins involved, <br /> no testing, <br /> slow updates, <br /> high risk of breakage"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"hoveron":"points","name":"FALSE","legendgroup":"FALSE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.1,0.5,0.8],"y":[0.1,0.5,0.8],"text":["Admins test and approve <br /> a subset of CRAN","All or most of CRAN, <br /> updated with R versions, <br /> tied to a system library","Open access, user or system <br /> records per-project dependencies"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(163,197,134,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(163,197,134,1)"}},"hoveron":"points","name":" TRUE","legendgroup":" TRUE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.125,0.525,0.525,0.825,0.775,0.225],"y":[0.125,0.525,0.775,0.825,0.225,0.825],"text":["Validated","Shared Baseline","Wild West","Snapshot","Blocked","Ticket System"],"hovertext":["","","","","",""],"textfont":{"size":14.6645669291339,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":44.4931506849315,"r":7.30593607305936,"b":40.9132420091324,"l":89.8630136986302},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"Reproducing Environments: Strategies and Danger Zones","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["Admins","","","","Users"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["Admins","","","","Users"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"Who is Responsible for Reproducing the Environment?","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["Locked Down","","","","Open"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["Locked Down","","","","Open"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"Package Access","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":1},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false,"displayModeBar":false},"source":"A","attrs":{"62673b6e8a5e":{"intercept":{},"slope":{},"type":"scatter"},"6267563e3fcd":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"626710ced7f7":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"62677bc4a1bf":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"62672a574214":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"626746b344c3":{"intercept":{},"slope":{}},"626723678278":{"x":{},"y":{},"colour":{},"text":{},"x.1":{},"y.1":{}},"626760a6a670":{"x":{},"y":{},"label":{},"x.1":{},"y.1":{}}},"cur_data":"62673b6e8a5e","visdat":{"62673b6e8a5e":["function (y) ","x"],"6267563e3fcd":["function (y) ","x"],"626710ced7f7":["function (y) ","x"],"62677bc4a1bf":["function (y) ","x"],"62672a574214":["function (y) ","x"],"626746b344c3":["function (y) ","x"],"626723678278":["function (y) ","x"],"626760a6a670":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly",".hideLegend":true},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null},{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
</div>
<h2 id="quicklinks">Quicklinks</h2>
<p>Successful Strategies:<br />
- <a href="./reproduce.html#snapshot-and-restore">Snapshot and Restore</a><br />
- <a href="./reproduce.html#shared-baseline">Shared Baseline</a><br />
- <a href="./reproduce.html#snapshot">Snapshot</a></p>
<p>Danger Zones:<br />
- <a href="./reproduce.html#ticket-system">Ticket System</a><br />
- <a href="./reproduce.html#wild-west">Wild West</a><br />
- <a href="./reproduce.html#blocked">Blocked</a></p>
<h2 id="snapshot-and-restore">Snapshot and Restore</h2>
<p>The snapshot and restore strategy fits when package access is open and users are responsible for reproducibility. This strategy is the most relevant for individual data scientists. The strategy has two key characteristics:</p>
<ol type="1">
<li>Users are able to <strong>freely</strong> access and install packages <strong>for a project</strong></li>
<li>Users have the full responsibility to <strong>record</strong> the dependencies needed for a project</li>
</ol>
<p>The strategy is implemented with the following steps:</p>
<ol type="1">
<li>Start a project be creating a project-specific library</li>
<li>Install and use packages from the projet-specific library</li>
<li>Record the state of the library alongside of the code</li>
<li>Restore the library when the environment needs to be recreated</li>
</ol>
<p>A potential drawback of this strategy is the invovlement required from the R user. For new users, these steps can create an energy barrier that prevents them from being successful. Often organizations will start new users (e.g. Excel converts) with a different strategy, and allow power R users the flexibility and responsibility of this strategy.</p>
<h3 id="snapshot-and-restore-using-renv">Snapshot and Restore using <code>renv</code></h3>
<p>A specific implementation of the four snapshot and restore steps is available in the <a href="https://github.com/rstudio/renv"><code>renv</code></a> package:</p>
<p><strong>Pre-requisite Steps</strong>:</p>
<ol type="1">
<li>(Administrators) Install each desired version of <a href="./installation.Rmd">R from source</a></li>
<li>(Users) Install the <code>renv</code> package</li>
</ol>
<p><strong>Per-project User Steps</strong>:</p>
<ol type="1">
<li>Be sure you are using version control for your code. We also recommend using RStudio Projects. Within the project folder, initialize a project environment:</li>
</ol>
<pre><code>
# From within the project working directory
renv::init()</code></pre>
<ol start="2" type="1">
<li>Install and use packages as normal. See <a href="./installation.Rmd">package installation</a> for details on <code>pak</code>, <code>remotes</code>, or <code>install.packages</code>. Use <code>library</code> or <code>require</code> within your project code.</li>
</ol>
<pre><code>
# After initializing the project environment
install.packages(...)</code></pre>
<ol start="3" type="1">
<li>Prior to commiting or pushing code changes, record the project’s dependencies:</li>
</ol>
<pre><code>
renv::snapshot()
# commit the resulting manifest file,  ./renv/&lt;date&gt;/&lt;date-time&gt;, alongside your project code</code></pre>
<ol start="4" type="1">
<li>To restore the environment, pull the code and manifest from your version control repository, then run:</li>
</ol>
<pre><code>
# To recreate the environment
renv::restore()</code></pre>
<h3 id="implementing-the-snapshot-strategy-in-production">Implementing the “Snapshot” Strategy in Production</h3>
<p>In some organizations, you may only want to worry about recording project dependencies when a project is ready for production. Generating a manifest of dependencies can be the first step in a deployment handoff between a development environment and a production deployment. <em>This scenario is especially common for web applications, APIs, and reports</em> written in R using <a href="https://shiny.rstudio.com">shiny</a>, <a href="https://rplumber.io">plumber</a>, and <a href="https://rmarkdown.rstudio.com">rmarkdown</a>.</p>
<p><strong>If you are using <a href="https://rstudio.com/products/connect">RStudio Connect</a> then the snapshot strategy is automatically applied when content is deployed</strong>.</p>
<h3 id="common-challenges-and-resolutions">Common Challenges and Resolutions:</h3>
<h4 id="versions-of-r">Versions of R</h4>
<p>To ensure the library is restorable, you’ll need to <em>record</em> and <em>make</em> <em>available</em> the same version of R used during development. The <code>renv</code> package automatically records the version of R used by a project. We recommend having multiple versions of R available, so that users can pick the version of R and then restore. This approach is also an effective way to <a href="./upgrades.html">test if a project is ready to upgrade</a> to a new version of R.</p>
<h4 id="non-current-cran-packages">Non-Current CRAN Packages</h4>
<p>Often, by the time a project is restored, some of the packages in use may have been updated on CRAN. For example:</p>
<ol type="1">
<li>On January 1st, a project manifest is committed that records <code>ISLR</code> version 1.0 as a dependency.</li>
<li>On February 1st, the <code>ISLR</code> package is upgraded to <code>1.1</code>.</li>
<li>On March 1st, a user wishes to restore the environment.</li>
</ol>
<p>In this case, it is critical that version 1.0 of <code>ISLR</code> is used in the restored environment. To make this happen, the older version of the package needs to be accessed and installed. Luckily, this is possible using a <a href="./repositories.html#archive-packages">repository’s archive</a>. <em>Internal repositories used to support the snapshot strategy must record archived versions.</em> <a href="https://rstudio.com/products/package-manager">RStudio Package Manager</a> is an easy way to ensure your internal repository handles this case appropriately.</p>
<h4 id="internal-packages">Internal Packages</h4>
<p>If your package is publicly available, tools like <code>renv</code> will work automatically. If you wish to use the snapshot strategy along with internal packages (packages that are not publicly available on CRAN nor in a public Git repository), it is easiest to store and source those internal packages in a <a href="./repositories.html">CRAN-like</a> repository. Follow these steps:</p>
<ol type="1">
<li>Release the internal package to the CRAN-like repository</li>
<li>Install and use the package in the project, installing from the repository</li>
<li>Record the project dependencies</li>
<li>Restore the project by accessing the appropriate version of the package from the CRAN-like repository</li>
</ol>
<p>It is critical that older versions of the internal package are appropriately stored in the repository’s archive.The easiest way to create a correct internal repository, distribute internal packages, and support the snapshot strategy is using <a href="https://rstudio.com/products/package-manager">RStudio Package Manager</a></p>
<h4 id="multi-lingual-projects-python">Multi-Lingual Projects (Python)</h4>
<p>If your project uses more than R, you’ll need to capture the project’s other dependencies as well. A common scenario is a <a href="https://rstudio.github.io/reticulate">reticulated project</a> that uses Python and R. In this case, one option is to combine <code>renv</code> with a Python package management tool like <code>virtualenv</code>:</p>
<ol type="1">
<li>Use <code>renv</code> as described previously to manage R packages</li>
<li>Use a <code>virutalenv</code> to isolate project Python dependencies</li>
<li>Record the state of the <code>virtualenv</code> using <code>pip freeze &gt; requirements.txt</code></li>
<li>On restore, recreate the Python <code>virtualenv</code> and then use <code>renv::restore()</code></li>
</ol>
<h4 id="performance">Performance</h4>
<p>A common challenge in the snapshot and restore approach is that each project relies on an isolated library. Naively, this would mean each project library would start empty and users would have to re-install their desired packages. In practice, this naive approach is slow - especially on systems where packages must be compiled.</p>
<p>To solve this problem, implementations of the snapshot and restore strategy should rely on a <a href="./installation.html">package cache</a> or a <a href="./repository.html#binary-packages">repository that serves binaries</a> for the operating systems in-use. By default, <code>renv</code> creates a cache for each user. This means if two projects rely on <code>ggplot2</code> version 3.1.0, the user will only need to install <code>ggplot2 3.1.0</code> once. A repository that serves binaries accomplishes the same result, by effectively caching installed packages for all users!</p>
<p>Often restoring a project on a different computer or a new system can take time because the necessary packages may not be cached. This challenge is especially prevalent if the project uses non-current CRAN packages, because these packages do not usually have a binary version available in a repository.</p>
<h4 id="docker">Docker</h4>
<p>Unfortunately, many organizations and platforms assume <a href="./docker.html">using Docker</a> will give them the benefits of reproducibility. The good news is that Docker does a great job isolating project dependencies. The bad news is that Docker does not record the versions of project dependencies. Luckily, Docker can be used with the snapshot and restore strategy. For example, say you wanted to use Docker to execute an ETL job:</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
FROM ubuntu
...
RUN git clone https://github.com/me/etl-project.git
RUN R -e &#39;renv::restore()&#39; 
CMD &lt;some process&gt;</code></pre>
</div>
<h3 id="additional-resources">Additional Resources:</h3>
<ul>
<li>Learn more about <a href="./libraries.html">libraries</a></li>
<li>Learn more about <a href="./repositories.html">repositories</a></li>
<li>Learn more about <a href="./installation.html">package installation</a></li>
</ul>
<h2 id="shared-baselines">Shared Baselines</h2>
<p>The shared baseline strategy fits when administrators or R champions are responsible for creating an environment where less experienced users can easily share and re-run work. The defining characteristics of the strategy are:</p>
<ol type="1">
<li>There are not strict requirements on what can be installed, the main motivation is ease of sharing.</li>
<li>Package availability is <strong>tied to R installations</strong> through site-wide libraries, and updates occur on a scheduled basis.</li>
</ol>
<p>A naive approach to this strategy is for an admin to install packages into a system library as users request them. Unfortunately, this approach is not a strategy but actually the <a href="./reproduce.html#ticket-system">Ticket System</a> danger zone! Before diving into the implementation steps, we need to understand the problem with this approach.</p>
<h3 id="the-big-risk">The BIG Risk</h3>
<p>Imagine the following scenario:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<ol type="1">
<li>January 1st, an admin installs <code>tibble</code> into the system library. The package is installed, along with the packages’s dependencies. Everything is in a consistent state because the packages all originate from CRAN on the same date, and CRAN tests to ensure the “latest” packages all work together.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<div id="htmlwidget-a3967842b0263c7179ac" style="width:576px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a3967842b0263c7179ac">{"x":{"diagram":"\ndigraph first {\n  node [shape = oval]\n  rlang; cli; crayon;\n  \n  node [shape = box]\n  tibble\n  \n  tibble->rlang\n  tibble->cli\n  tibble->crayon\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Partial Dependency Graph for tibble
</p>
</div>
</div>
<ol start="2" type="1">
<li>February 1st, the admin receives a request to install <code>pkgdown</code>. In doing so, <code>pkgdown</code> is installed along with its dependencies, <strong>which include <code>rlang</code>, <code>cli</code>, and <code>crayon</code></strong>. These dependencies are updated, but <code>tibble</code> is not. The result is an inconsistent state, where some packages come from February 1st and some from January 1st. This mixed set is <em>not</em> tested by CRAN, and can lead to an error for anyone using <code>tibble</code>.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<div id="htmlwidget-a398b1d2aa7f6fc2c18c" style="width:576px;height:384px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a398b1d2aa7f6fc2c18c">{"x":{"diagram":"\ndigraph first {\n  node [shape = oval\n        style = filled\n        fillcolor = grey]\n  rlang; cli; crayon\n  \n  node [shape = box\n        style = filled\n        fillcolor = grey]\n  pkgdown\n  \n  node [shape = box\n        style = filled\n        fillcolor = white]\n  tibble\n  \n  tibble->rlang\n  tibble->cli\n  tibble->crayon\n  pkgdown->rlang\n  pkgdown->cli\n  pkgdown->crayon\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Updated Graph
</p>
</div>
</div>
<aside>
White - January Versions Grey - February Versions
</aside>
<p>The benefit of the shared baseline approach is that everyone uses the same installed packages. The problem is if an administrator updates packages, the update could create an inconsistent state that breaks other users’ code. The main benefit has turned into a big risk!</p>
<blockquote>
<p>Note: This scenario can also occur for individual users who share a package library across projects. The likelihood of conflict just increases if multiple users share a library.</p>
</blockquote>
<p>How do we prevent this problem? One option would be for an administrator to install all the packages at once. Unfortunately, this rarely works in practice because it is incredibly time intensive and users don’t know upfront the entire list of packages they’ll need.</p>
<h4 id="frozen-repositories">Frozen Repositories</h4>
<p>A better option is to rely on a frozen repository. A frozen repository is a way for organizations to always get a consistent set of packages, without having to pre-install all the packages. As an example, you could rsync CRAN to an internal server on January 1st and host it at <code>https://r-pkgs.example.com/cran/012019</code>. Then, no matter when an admin installed new packages, they would always get a consistent set of packages. The next time a version of R is released, the new version of R can be associated with a new frozen repository, e.g. <code>https://r-pkgs.example.com/cran/062019</code>, allowing users to get updated and new packages while still remaining consistent. The specific steps for this approach are documented below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure">
<img src="reproduce_files/figure-html5/unnamed-chunk-4-1.png" alt="Shared Basline Strategy" width="576" />
<p class="caption">
Shared Basline Strategy
</p>
</div>
</div>
<p>Overtime, managing these repositories can become tedious, <a href="https://rstudio.com/products/package-manager">RStudio Package Manager</a> provides an easy way to automatically access snapshots that additionally optimizes disk space and supports internal, non-CRAN packages.</p>
<h3 id="implementation-steps">Implementation Steps</h3>
<p>This strategy requires a “frozen repository”, as described above. Organizations can create frozen repositories manually, tie into <a href="https://mran.microsoft.com/">MRAN</a>, or use <a href="https://docs.rstudio.com/rspm/admin/repositories.html#repo-versions">RStudio Package Manager</a>.</p>
<ol type="1">
<li>Install a <a href="./R-installation.html">version of R from source</a>. This results in a versioned system library:</li>
</ol>
<pre><code>
/opt/R/3.4.4/lib/R/library</code></pre>
<ol start="2" type="1">
<li>Create or edit the <code>Rprofile.site</code> file, to set the <code>repo</code> option for this version of R to point to a frozen repository.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
# /opt/R/3.4.4/etc/Rprofile.site
local({
  options(repos = c(CRAN = &quot;https://r-pkgs.example.com/cran/128&quot;))
})</code></pre>
</div>
<ol start="3" type="1">
<li>Run R as root, and install the desired baseline packages. Overtime, as requests for new packages come in, install them in the same way. Consistency is gauranteed because you are always installing from the same frozen repository.</li>
</ol>
<pre><code>
sudo /opt/R/3.4.4./bin/R -e &#39;install.packages(&quot;ggplot2&quot;)&#39;</code></pre>
<ol start="4" type="1">
<li><p>Users access packages on the server without any need to install, e.g.: <code>library(ggplot2)</code></p></li>
<li><p>(Optionally) Disable the user option to change the repository setting and discourage package installation.</p></li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
# /etc/rstudio/rsession.conf
allow-r-cran-repos-edit=0
allow-package-installation=0</code></pre>
</div>
<ol start="5" type="1">
<li>(Optionally) Allow users to install packages into their personal user libraries. The user library is still tied to the R version, and the repository is still frozen due to the <code>Rprofile.site option</code>. In this case, users won’t all have the same packages, but if they share code and then install packages, they’ll get the same versions.</li>
</ol>
<h3 id="common-challenges-and-resolutions-1">Common Challenges and Resolutions</h3>
<h4 id="desktop-r-users">Desktop R Users</h4>
<p>The implementation described for the shared baseline strategy assumes users are access R on a shared server, using a tool like RStudio Server (Pro). Often, teams of data scientists using R from their desktops also want easy collaboration and the benefits of uniform package versions. This result is possible by adapting the strategy. Desktop users simply need to set their repository option to use a frozen repository. If all users pick the same frozen repository, they’ll get the benefits of the strategy. Desktop users can set the repository using the <code>Rprofile.site</code> mechansim, or using a wizard available in RStudio (v1.2+) <code>Tools -&gt; Global Options -&gt; Packages</code>.</p>
<h4 id="new-or-updated-packages">New or Updated Packages</h4>
<p>What happens if a package is updated immediately after the shared baseline is implemented? Or a new package is added? For example, what would happen if the repository is frozen on April 1st, and April 5th a new package is added? In this case, users would need to wait until the next release to pull in this update. We recommend organizations roll out new versions of R (and new package sets) every 4-6 months.</p>
<p>Luckily, this type of time delay will not impact most R users. The need to access the latest and greatest packages is rare for the majority of R users, especially new R users. We recommend allowing advanced R users who require this type of “bleeding edge” access to use the <a href="./reproduce.html#snapshot-and-restore">Snapshot and Restore</a> strategy. If a critical security issue arises that requires a package update, re-install the version of R in a new directory, e.g. <code>/opt/R/3.4.4-patch/</code> and follow the entire process, perhaps removing the old R version.</p>
<h4 id="internal-packages-1">Internal Packages</h4>
<p>The shared baseline strategy works with internal packages as long as those packages are available in a frozen, CRAN-like repository. <a href="https://docs.rstudio.com/rspm/admin/quickstarts.html#quickstart-local">RStudio Package Manager</a> makes it easy to include local packages in repository checkpoints.</p>
<h4 id="docker-1">Docker</h4>
<p>Docker can be used alongside the shared baseline strategy to ensure that rebuilding a Docker image always returns the same sets of packages. Docker makes the process easier, because it negates the need to manage a system library shared by multiple users.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
FROM ubuntu
...
# To install packages
RUN R -e &#39;install.packages(..., repo = &quot;https://r-pkgs.example.com/cran/042018&quot;)&#39;
# Or set the repo option if users will install packages in the container
RUN echo &#39;options(repos = c(CRAN = &quot;https://r-pkgs.example.com/cran/042018&quot;))&#39; &gt; .Rprofile</code></pre>
</div>
<h2 id="validated">Validated</h2>
<p>The validated strategy is similar to the <a href="./reproduce.html#shared-baseline">shared baseline</a> strategy. The main difference is the validated strategy targets teams wishing to restrict access to a particular set of packages and teams wishing to approve or audit changes to the package environment. This strategy is appropriate if you require:</p>
<ul>
<li>licensing checks</li>
<li>tests to ensure accurate package methods<br />
</li>
<li>security audits</li>
</ul>
<p>Please refer to the section <a href="./picking.html">picking packages</a> for more ideas on how to arrive at an approved set of packages. Once a set is determined, this strategy ensures users accurately use those packages.</p>
<blockquote>
<p>Note: This strategy describes how to manage approved sets of packages, see the <a href="./validation.html">validation</a> section for more information on other considerations in validated environments</p>
</blockquote>
<p>The implementation steps<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> are divided into two parts:</p>
<ol type="1">
<li>Steps taken by the administrator (could be an R user) responsible for creating and updating the approved set</li>
<li>Steps taken by the user wishing to use the approved set</li>
</ol>
<h3 id="admin-steps-creating-the-validated-set">Admin Steps: Creating the Validated Set</h3>
<p>We recommend that an admin organize the validated set of packages into an <a href="./repositories#internal-repositories">internal repository</a>. Organizing the packages into a repository, as opposed to a library, has the major benefit of decoupling the approved packages from a specific installed environment. This separation is helpful because it enables the approved packages can be used in different places: desktops, containers, and shared servers.</p>
<ol type="1">
<li><p>Create a <a href="./repositories.html#">frozen repository</a> containing all of CRAN along with any other packages you might need.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p></li>
<li><p>Create a list of desired top-level packages:</p></li>
</ol>
<pre><code>
xgboost
shiny</code></pre>
<ol start="3" type="1">
<li>Given the list, identify the package’s dependencies to get the full set of packages:</li>
</ol>
<pre><code>
rstudio-pm: $ ./bin/rspm add --file-in=list.csv --source=validated --dryrun
This action will add the following packages:

Name        Version  Path              License                                Needs Compilation Dependency Already Available
BH          1.69.0-1                   BSL-1.0                                no                true       false
crayon      1.3.4                      MIT + file LICENSE                     no                true       false
data.table  1.12.0                     MPL-2.0 | file LICENSE                 yes               true       false
digest      0.6.18                     GPL (&gt;= 2)                             yes               true       false
htmltools   0.3.6                      GPL (&gt;= 2)                             yes               true       false
httpuv      1.4.5.1                    GPL (&gt;= 2) | file LICENSE              yes               true       false
jsonlite    1.6                        MIT + file LICENSE                     yes               true       false
later       0.8.0                      GPL (&gt;= 2)                             yes               true       false
lattice     0.20-38                    GPL (&gt;= 2)                             yes               true       false
lattice     0.20-38  3.5.3/Recommended GPL (&gt;= 2)                             yes               true       false
lattice     0.20-38  3.6.0/Recommended GPL (&gt;= 2)                             yes               true       false
magrittr    1.5                        MIT + file LICENSE                     no                true       false
Matrix      1.2-15                     GPL (&gt;= 2) | file LICENCE              yes               true       false
Matrix      1.2-15   3.5.3/Recommended GPL (&gt;= 2) | file LICENCE              yes               true       false
Matrix      1.2-15   3.6.0/Recommended GPL (&gt;= 2) | file LICENCE              yes               true       false
mime        0.6                        GPL                                    yes               true       false
promises    1.0.1                      MIT + file LICENSE                     yes               true       false
R6          2.4.0                      MIT + file LICENSE                     no                true       false
Rcpp        1.0.0                      GPL (&gt;= 2)                             yes               true       false
rlang       0.3.1                      GPL-3                                  yes               true       false
shiny       1.2.0                      GPL-3 | file LICENSE                   no                false      false
sourcetools 0.1.7                      MIT + file LICENSE                     yes               true       false
stringi     1.3.1                      file LICENSE                           yes               true       false
xgboost     0.81.0.1                   Apache License (== 2.0) | file LICENSE yes               false      false
xtable      1.8-3                      GPL (&gt;= 2)                             no                true       false

To complete this operation, execute this command without the --dryrun flag. You will need to include the --transaction-id=1506 flag.
</code></pre>
<aside>
This example shows the RStudio Package Manager command and output for this step, but the main idea is to identify the depedencies for xgboost and shiny.
</aside>
<ol start="4" type="1">
<li><p>At this point, apply any filtering or additional testing to confirm the packages meet your licensing requirements, methodology validation, etc. If a package must be removed, ensure that you remove all upstream dependencies as well. An easy way to do this is to remove packages from your list in step 2, repeating step 3 until the troublesome package is no longer required.</p></li>
<li><p>Place the approved set of packages in the internal repository.</p></li>
</ol>
<h3 id="admin-steps-updating-the-validated-set">Admin Steps: Updating the Validated Set</h3>
<p>To <strong>add a new package</strong> to the approved set, it is critical that you either <em>update all of the packages</em> or add the new package <em>from the original frozen repository</em> created in step 1. Learn more about the <a href="./reproduce.html#the-big-risk">danger of partial upgrades here</a>.</p>
<pre><code>
rstudio-pm: $ ./bin/rspm add --packages=plumber --source=validated --dryrun             
This action will add the following packages:

Name     Version  Path License                   Needs Compilation Dependency Already Available
BH       1.69.0-1      BSL-1.0                   no                true       true
crayon   1.3.4         MIT + file LICENSE        no                true       true
httpuv   1.4.5.1       GPL (&gt;= 2) | file LICENSE yes               true       true
jsonlite 1.6           MIT + file LICENSE        yes               true       true
later    0.8.0         GPL (&gt;= 2)                yes               true       true
magrittr 1.5           MIT + file LICENSE        no                true       true
plumber  0.4.6         MIT + file LICENSE        no                false      false
promises 1.0.1         MIT + file LICENSE        yes               true       true
R6       2.4.0         MIT + file LICENSE        no                true       true
Rcpp     1.0.0         GPL (&gt;= 2)                yes               true       true
rlang    0.3.1         GPL-3                     yes               true       true
stringi  1.3.1         file LICENSE              yes               true       true

To complete this operation, execute this command without the --dryrun flag. You will need to include the --transaction-id=1506 flag.
</code></pre>
<aside>
Example of adding <code>plumber</code> to the package set containing <code>xgboost</code> and <code>shiny</code> using RStudio Package Manager
</aside>
<p>To update all of the packages, repeat steps 1-5 above, starting with a new frozen repository in step 1.</p>
<pre><code>
rstudio-pm: $ ./bin/rspm add --packages=plumber --source=validated --dryrun             
This action will add the following packages:

Name     Version  Path License                   Needs Compilation Dependency Already Available
BH       1.69.0-1      BSL-1.0                   no                true       true
crayon   1.3.4         MIT + file LICENSE        no                true       true
httpuv   1.4.5.1       GPL (&gt;= 2) | file LICENSE yes               true       true
jsonlite 1.6           MIT + file LICENSE        yes               true       true
later    0.8.0         GPL (&gt;= 2)                yes               true       true
magrittr 1.5           MIT + file LICENSE        no                true       true
plumber  0.4.6         MIT + file LICENSE        no                false      false
promises 1.0.1         MIT + file LICENSE        yes               true       true
R6       2.4.0         MIT + file LICENSE        no                true       true
Rcpp     1.0.0         GPL (&gt;= 2)                yes               true       true
rlang    0.3.1         GPL-3                     yes               true       true
stringi  1.3.1         file LICENSE              yes               true       true

To complete this operation, execute this command without the --dryrun flag. You will need to include the --transaction-id=1506 flag.</code></pre>
<aside>
Sample the changes needed to update <code>xgboost</code> and <code>shiny</code> set from December 18th, 2018 to March 3rd, 2019.
</aside>
<h3 id="user-steps-accessing-the-validated-set">User Steps: Accessing the Validated Set</h3>
<p>There are three options for accessing the set of validated packages:</p>
<ol type="1">
<li>If you are using a <em>Docker container</em>, add a line to install the available packages from the internal repositoy:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
FROM ubuntu
...
RUN R -e &#39;options(repos = c(CRAN = &quot;https://r-pkgs.example.com/validated&quot;)); install.packages(available.packages()[,&quot;Package&quot;])&#39;</code></pre>
</div>
<ol start="2" type="1">
<li>If you are creating a shared environment for <strong>multiple users</strong>, then set the repo option in the <code>Rprofile.site</code> to point at the internal repository, and optionally install the available packages. For more details, refer to the <a href="./reproduce.html#shared-baseline">shared baseline</a> strategy above, replacing the generic frozen repository with your validated internal repository.</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="bash"><code>
# after installing R from source
# set the repo option in Rprofile.site
sudo echo &#39;options(repos = c(CRAN = &quot;https://r-pkgs.example.com/validated&quot;))&#39; &gt; R_HOME/etc/Rprofile.site

# optionally, install the packages
sudo R_HOME/bin/R -e &#39;install.packages(available.packages()[,&quot;Package&quot;])&#39;</code></pre>
</div>
<ol start="3" type="1">
<li>If you are <strong>an individual</strong> working on a specific project, you can use the <code>renv</code> package to create an isolated project environment and library associated with the validated package set:</li>
</ol>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# from within your project directory
renv::init()

# update the renv to use the validated set from the internal repository
renv::modify()

# install packages like normal
install.packages(...)</code></pre>
</div>
<h3 id="user-steps-accessing-updates-to-the-validated-set">User Steps: Accessing Updates to the Validated Set</h3>
<p>Likewise, there are three options for accessing an update to the set of validated packages:</p>
<ol type="1">
<li><p>If you are using a <strong>Docker container</strong>, simply rebuild the image.</p></li>
<li><p>If you are administering a shared environment for <strong>multiple users</strong>, create a new R installation from source, and set the repo option in your <code>Rprofile.site</code>. For more details, refer to the <a href="./reproduce.html#shared-baseline">shared baseline</a> strategy above, replacing the generic frozen repository with your validated internal repository.</p></li>
<li><p>If you are working on a <strong>specific project using <code>renv</code></strong>, first run <code>renv::snapshot()</code> to save the current state, and then run <code>update.packages()</code> from within your project.</p></li>
</ol>
<h2 id="danger-zones">Danger Zones</h2>
<p>These sections provide more detail on areas of our map where “who” is in control and “what” can be installed are mis-aligned to create painful environments that can not be reliably recreated. In addition to describing the characteristics of each zone, a recommendation is made on how to identify a more appropriate strategy.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div id="62677e4c7887" style="width:576px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="62677e4c7887">{"x":{"data":[{"x":[-0.05,1.05],"y":[0.15,1.25],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.2)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,0,0.8,0],"y":[0.2,1,1,0.2],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(255,0,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,1,0.8,0,0],"y":[null,0.8,1,0.2,null],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,255,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0,0,1,0.2,0],"y":[0,0.2,0.8,0,0],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(0,255,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[0.2,1,1,0.2],"y":[0,0,0.8,0],"text":"NA","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(255,0,0,0.1)","hoveron":"fills","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"skip","frame":null},{"x":[-0.05,1.05],"y":[-0.25,0.85],"text":"","type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,0,0,0.2)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.5,0.75,0.2],"y":[0.75,0.2,0.8],"text":["Open access, <br /> not reproducible, <br /> how we learn","Backdoor package access, <br /> offline systems without a strategy","Admins involved, <br /> no testing, <br /> slow updates, <br /> high risk of breakage"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,0,0,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(255,0,0,1)"}},"hoveron":"points","name":"FALSE","legendgroup":"FALSE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.1,0.5,0.8],"y":[0.1,0.5,0.8],"text":["Admins test and approve <br /> a subset of CRAN","All or most of CRAN, <br /> updated with R versions, <br /> tied to a system library","Open access, user or system <br /> records per-project dependencies"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(163,197,134,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(163,197,134,1)"}},"hoveron":"points","name":" TRUE","legendgroup":" TRUE","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.125,0.525,0.525,0.825,0.775,0.225],"y":[0.125,0.525,0.775,0.825,0.225,0.825],"text":["Validated","Shared Baseline","Wild West","Snapshot","Blocked","Ticket System"],"hovertext":["","","","","",""],"textfont":{"size":14.6645669291339,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":44.4931506849315,"r":7.30593607305936,"b":40.9132420091324,"l":89.8630136986302},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"Reproducing Environments: Strategies and Danger Zones","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["Admins","","","","Users"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["Admins","","","","Users"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":"Who is Responsible for Reproducing the Environment?","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["Locked Down","","","","Open"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["Locked Down","","","","Open"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"Package Access","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":1},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false,"displayModeBar":false},"source":"A","attrs":{"6267640d8724":{"intercept":{},"slope":{},"type":"scatter"},"626734237fcd":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"626769b8679":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"62674c997552":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"62676ee581c7":{"x":{},"y":{},"text":{},"x.1":{},"y.1":{}},"62671dab68b2":{"intercept":{},"slope":{}},"626760668d55":{"x":{},"y":{},"colour":{},"text":{},"x.1":{},"y.1":{}},"62676cc8f8e4":{"x":{},"y":{},"label":{},"x.1":{},"y.1":{}}},"cur_data":"6267640d8724","visdat":{"6267640d8724":["function (y) ","x"],"626734237fcd":["function (y) ","x"],"626769b8679":["function (y) ","x"],"62674c997552":["function (y) ","x"],"62676ee581c7":["function (y) ","x"],"62671dab68b2":["function (y) ","x"],"626760668d55":["function (y) ","x"],"62676cc8f8e4":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly",".hideLegend":true},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null},{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
</div>
<h3 id="wild-west">Wild West</h3>
<p>The wild west scenario occurs when users are given free reign to install packages with no strategy for reproducing package environments.</p>
<h4 id="recommendations">Recommendations:</h4>
<ul>
<li><p>If you are a single data scientist, or in a team of experienced data scientists, consider moving to the <a href="./reproduce.html#snapshot-and-restore">snapshot and restore</a> strategy.</p></li>
<li><p>If you are working with a group of newer users, consider working with IT to setup the <a href="./reproduce.html#shared-baseline">shared baseline</a> strategy. Be careful not to slip into the <a href="./reproduce.html#ticket-system">ticket system</a> scenario, which occurs if you ask IT to restrict the system without teaching them how to manage shared baselines. It might make sense to use the shared baseline strategy by default, and allow experienced users to step into the snapshot strategy.</p></li>
</ul>
<h3 id="ticket-system">Ticket System</h3>
<p>The ticket system scenario occurs when administrators are involved in package installation, but they do not have a strategy for ensuring consistent and safe package updates; for example:</p>
<ol type="1">
<li>A user wants a new package installed, so they submit a ticket to have the package added</li>
<li>An admin receives the ticket, and manually installs the new package into the system library</li>
</ol>
<p>This scenario is problematic because it encourages <a href="./reproduce.html#the-big-risk">partial upgrades</a>, is often slow, and still results in broken environments!</p>
<h4 id="recommendation">Recommendation</h4>
<ul>
<li><p>If your organization requires admin involvement for practical reasons, (e.g. you’re working on offline server), consider adopting the <a href="./reproduce.html#shared-baseline">shared baseline</a> strategy.</p></li>
<li><p>If your organization requires admin involvement for strategic reasons (e.g. you have concerns about package licenses), consider adopting the <a href="./reproduce.html#validation.html">validation</a> strategy.</p></li>
</ul>
<h3 id="blocked">Blocked</h3>
<p>The blocked scenario occurs when servers are locked down, but there is no strategy in place for R package access. This strategy often leads R users to “backdoor” approaches to package access, such as manually copying over installed packages.</p>
<p>In this scenario, it is important for R users to level-set with IT on why R packages are essential to successful data science work. You may need to refer to the <a href="./validation.html">validation</a> section of the site or the section on <a href="./picking.html">picking packages</a>, both of which help explain where packages come from and address issues around trust.</p>
<p>Come to this discussion prepared to advocate for either the <a href="./reproduce.html#shared-baseline">shared baseline</a> or <a href="./reproduce.html#validated">validation</a> strategies. It may also help your admin team to know that there are supported products, like <a href="https://rstudio.com/products/package-manager">RStudio Package Manager</a> designed to help them help you!</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The scenario is hypothetical and simplified, you should not be concerned about the specific packages and dates used in the example.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>The implementation steps for this strategy rely the most heavily on RStudio Package Manager. While you can accomplish this strategy without a paid product, if you are using R in a validated context it is probably worth the licensing fee to do things the easy, correct way!<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>RStudio Package Manager handles this step automatically<a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
